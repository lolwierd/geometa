(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[481],{5927:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>y});var a=s(5155),l=s(2115),r=s(760),n=s(8274),c=s(285),i=s(9803),o=s(1154),d=s(1243),x=s(2355),m=s(5830),h=s(2713),u=s(6874),f=s.n(u),w=s(3843),g=s(6766),j=s(822),p=s(3052),b=s(4516),N=s(7863);function v(e){let{location:t}=e,[s,r]=(0,l.useState)(0),[n,i]=(0,l.useState)({}),[o,d]=(0,l.useState)(!1),m=(0,l.useRef)(null),h=Array.isArray(t.images)?t.images.filter(e=>e&&!n[e]):[],u=e=>e?"".concat(w.JR,"/img?u=").concat(encodeURIComponent(e)):"",f=(e=>{if(!e)return null;let t=new DOMParser().parseFromString(e,"text/html").querySelector("a");return t?t.href:null})(t.footer),v=t.note?j.A.sanitize(t.note):"";return(0,l.useEffect)(()=>{o&&m.current&&m.current.scrollIntoView({behavior:"smooth",block:"nearest"})},[o]),(0,a.jsxs)("div",{className:"w-full max-w-3xl mx-auto bg-slate-800 border border-slate-700 rounded-lg overflow-hidden flex flex-col",children:[(0,a.jsx)("div",{className:"flex-shrink-0 p-4 bg-slate-900/50",children:(0,a.jsx)("div",{className:"flex items-center justify-between gap-4 w-full",children:(0,a.jsxs)("div",{className:"flex items-center gap-4 text-white flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[t.country_code&&(0,a.jsx)(a.Fragment,{children:f?(0,a.jsx)("a",{href:f,target:"_blank",rel:"noopener noreferrer",onClick:e=>e.stopPropagation(),title:"Open source link",className:"flex-shrink-0",children:(0,a.jsx)(g.default,{src:u("https://flagcdn.com/64x48/".concat(t.country_code.toLowerCase(),".png")),width:32,height:24,alt:"".concat(t.country," flag"),className:"rounded-sm border-slate-600 hover:border-blue-400 transition-colors",unoptimized:!0,onError:e=>e.target.style.display="none"})}):(0,a.jsx)(g.default,{src:u("https://flagcdn.com/64x48/".concat(t.country_code.toLowerCase(),".png")),width:32,height:24,alt:"".concat(t.country," flag"),className:"rounded-sm border-slate-600 flex-shrink-0",unoptimized:!0,onError:e=>e.target.style.display="none"})}),(0,a.jsx)("span",{className:"text-2xl font-bold",children:t.country})]}),t.meta_name&&(0,a.jsx)("span",{className:"text-lg text-slate-300 font-normal text-right",children:t.meta_name})]})})}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 sm:p-6 space-y-6 [scrollbar-gutter:stable]",children:[t.note&&(0,a.jsx)("div",{className:"prose prose-invert prose-slate max-w-none text-base",children:(0,a.jsx)("div",{dangerouslySetInnerHTML:{__html:v}})}),h.length>0&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"relative rounded-lg overflow-hidden bg-slate-900/50 border border-slate-700",children:[(0,a.jsx)(g.default,{src:u(h[s]),alt:"Meta image ".concat(s+1),width:1920,height:1080,className:"w-full max-h-[60vh] object-contain rounded-md",unoptimized:!0,onError:()=>{var e;return e=h[s],void i(t=>({...t,[e]:!0}))}}),h.length>1&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(c.$,{variant:"outline",size:"sm",onClick:e=>{e.stopPropagation(),r(e=>(e-1+h.length)%h.length)},className:"absolute left-2 top-1/2 -translate-y-1/2 bg-black/70 border-slate-600 text-white hover:bg-black/90 h-9 w-9 sm:h-8 sm:w-8",children:(0,a.jsx)(x.A,{className:"h-5 w-5"})}),(0,a.jsx)(c.$,{variant:"outline",size:"sm",onClick:e=>{e.stopPropagation(),r(e=>(e+1)%h.length)},className:"absolute right-2 top-1/2 -translate-y-1/2 bg-black/70 border-slate-600 text-white hover:bg-black/90 h-9 w-9 sm:h-8 sm:w-8",children:(0,a.jsx)(p.A,{className:"h-5 w-5"})})]})]}),h.length>1&&(0,a.jsx)("div",{className:"flex justify-center gap-2 pt-2",children:h.map((e,t)=>(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),r(t)},className:"w-2.5 h-2.5 rounded-full transition-colors ".concat(t===s?"bg-blue-500":"bg-slate-600 hover:bg-slate-500"),title:"Image ".concat(t+1)},t))})]}),o&&(0,a.jsxs)("div",{ref:m,className:"pt-6 border-t border-slate-700",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h4",{className:"font-medium text-lg text-slate-200",children:"Technical Details"}),(0,a.jsx)("a",{href:"https://www.google.com/maps?layer=c&panoid=".concat(t.pano_id),target:"_blank",rel:"noopener noreferrer",title:"Open in Google Street View",children:(0,a.jsxs)(c.$,{variant:"outline",size:"sm",className:"bg-slate-700 border-slate-600 text-white hover:bg-slate-600",children:[(0,a.jsx)(b.A,{className:"h-4 w-4 mr-2"}),"Street View"]})})]}),(0,a.jsxs)("dl",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4 text-sm",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("dt",{className:"font-medium text-slate-400",children:"Pano ID"}),(0,a.jsx)("dd",{className:"bg-slate-900 px-3 py-1.5 rounded-md text-xs font-mono border border-slate-700 text-slate-300",children:t.pano_id})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("dt",{className:"font-medium text-slate-400",children:"Map ID"}),(0,a.jsx)("dd",{className:"bg-slate-900 px-3 py-1.5 rounded-md text-xs font-mono border border-slate-700 text-slate-300",children:t.map_id})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("dt",{className:"font-medium text-slate-400",children:"Collected"}),(0,a.jsxs)("dd",{className:"text-slate-300 pt-1",children:[(0,a.jsx)("span",{className:"block",children:new Date(t.created_at).toLocaleDateString()}),(0,a.jsx)("span",{className:"block text-xs text-slate-500",children:new Date(t.created_at).toLocaleTimeString()})]})]}),t.updated_at!==t.created_at&&(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("dt",{className:"font-medium text-slate-400",children:"Updated"}),(0,a.jsxs)("dd",{className:"text-slate-300 pt-1",children:[(0,a.jsx)("span",{className:"block",children:new Date(t.updated_at).toLocaleDateString()}),(0,a.jsx)("span",{className:"block text-xs text-slate-500",children:new Date(t.updated_at).toLocaleTimeString()})]})]})]})]})]}),(0,a.jsx)("div",{className:"flex-shrink-0 text-center border-t border-slate-700",children:(0,a.jsx)(c.$,{variant:"ghost",size:"sm",onClick:()=>d(!o),className:"h-8 w-full text-slate-500 hover:text-white hover:bg-slate-700/50 rounded-none",title:o?"Hide details":"Show details",children:(0,a.jsx)(N.A,{className:"h-5 w-5 transition-transform duration-200 ".concat(!o&&"rotate-180")})})})]})}function y(){let[e,t]=(0,l.useState)(null),[s,u]=(0,l.useState)(!0),[g,j]=(0,l.useState)(null),[p,b]=(0,l.useState)(null),[N,y]=(0,l.useState)(null),[k,S]=(0,l.useState)([]),[_,A]=(0,l.useState)([]),[C,E]=(0,l.useState)([]),[z,D]=(0,l.useState)([]),L=(0,l.useCallback)(async()=>{u(!0),j(null),b(null);try{let e=new URLSearchParams;C.length&&e.set("country",C.join(",")),z.length&&e.set("continent",z.join(","));let s=e.toString(),a=await fetch("/api/memorizer".concat(s?"?".concat(s):"")),l=await a.json();if(!a.ok||!l.success)throw Error(l.message||"Could not get next card.");let{location:r,stats:n,countries:c,continents:i}=l;y(n),t(r),c&&S(c),i&&A(i)}catch(e){j(e instanceof Error?e.message:"An unknown error occurred")}finally{u(!1)}},[C,z]);(0,l.useEffect)(()=>{L()},[L]);let $=(0,l.useCallback)(async t=>{if(e){b(null);try{let s=await fetch("".concat(w.JR,"/memorizer"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({locationId:e.id,quality:t})}),a=await s.json();if(!s.ok||!a.success)throw Error(a.message||"Failed to update progress.");L()}catch(e){b(e instanceof Error?e.message:"An unknown error occurred"),console.error("Failed to update progress:",e)}}},[L,e]);return(0,l.useEffect)(()=>{let e=e=>{switch(e.key){case"1":case"ArrowLeft":$(0);break;case"2":case"ArrowDown":$(2);break;case"3":case"ArrowUp":$(3);break;case"4":case"ArrowRight":$(5)}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[$]),(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-b from-slate-900 via-slate-800 to-slate-900 text-white",children:(0,a.jsxs)("div",{className:"container mx-auto px-4 py-4 sm:py-6 flex flex-col min-h-screen",children:[(0,a.jsx)("div",{className:"w-full flex-shrink-0",children:(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6 sm:mb-8",children:[(0,a.jsx)("div",{className:"w-10 sm:w-36",children:(0,a.jsx)(f(),{href:"/","aria-label":"Back to Gallery",children:(0,a.jsx)(c.$,{variant:"outline",size:"icon",className:"bg-slate-700 border-slate-600 text-white hover:bg-slate-600 h-10 w-10",children:(0,a.jsx)(x.A,{className:"h-6 w-6"})})})}),(0,a.jsxs)("h1",{className:"text-xl sm:text-2xl font-bold flex items-center justify-center text-center",children:[(0,a.jsx)(m.A,{className:"h-7 w-7 mr-2"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"Meta Memorizer"})]}),(0,a.jsxs)("div",{className:"w-10 sm:w-36 flex items-center justify-end gap-2 text-right",children:[N&&!s&&(0,a.jsxs)("span",{className:"text-xs sm:text-sm text-slate-500",children:[N.new,"/",N.newTotal," new, ",N.review,"/",N.reviewTotal," reviews, ",N.lapsed,"/",N.lapsedTotal," lapsed due today"]}),(0,a.jsx)(f(),{href:"/stats","aria-label":"Review stats",children:(0,a.jsx)(c.$,{variant:"outline",size:"icon",className:"bg-slate-700 border-slate-600 text-white hover:bg-slate-600 h-10 w-10",children:(0,a.jsx)(h.A,{className:"h-5 w-5"})})})]})]})}),(0,a.jsxs)("div",{className:"mb-4 flex flex-col sm:flex-row gap-4",children:[(0,a.jsx)(i.h,{options:_.map(e=>({value:e,label:e})),selected:z,onChange:e=>{D(e)},placeholder:"Filter by continent...",className:"w-full sm:w-[220px]"}),(0,a.jsx)(i.h,{options:k.map(e=>({value:e,label:e})),selected:C,onChange:e=>{E(e)},placeholder:"Filter by country...",className:"w-full sm:w-[280px]"})]}),(0,a.jsx)("div",{className:"w-full flex-grow flex items-center justify-center",children:s?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center text-center h-96",children:[(0,a.jsx)(o.A,{className:"w-12 h-12 animate-spin text-blue-400"}),(0,a.jsx)("p",{className:"mt-4 text-slate-300",children:"Finding the next card for you..."})]}):g?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center text-center text-red-400 h-96",children:[(0,a.jsx)(d.A,{className:"w-12 h-12 mb-4"}),(0,a.jsx)("h3",{className:"text-xl font-semibold text-white",children:"An Error Occurred"}),(0,a.jsx)("p",{className:"text-red-400",children:g}),(0,a.jsx)(c.$,{onClick:L,variant:"outline",className:"mt-6 bg-slate-700 border-slate-600 hover:bg-slate-600",children:"Try Again"})]}):e?(0,a.jsx)(r.N,{mode:"wait",children:(0,a.jsxs)(n.P.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.2},className:"w-full flex flex-col items-center",children:[(0,a.jsx)("div",{className:"w-full",children:(0,a.jsx)(v,{location:e})}),(0,a.jsxs)("div",{className:"mt-8 flex-shrink-0 w-full max-w-lg flex flex-col sm:flex-row justify-around items-center gap-4",children:[(0,a.jsx)(c.$,{onClick:()=>$(0),variant:"destructive",className:"w-full sm:w-32 h-12 text-lg font-semibold",children:"Again"}),(0,a.jsx)(c.$,{onClick:()=>$(2),variant:"secondary",className:"w-full sm:w-32 h-12 text-lg font-semibold",children:"Hard"}),(0,a.jsx)(c.$,{onClick:()=>$(3),variant:"secondary",className:"w-full sm:w-32 h-12 text-lg font-semibold",children:"Good"}),(0,a.jsx)(c.$,{onClick:()=>$(5),className:"bg-green-600 hover:bg-green-700 w-full sm:w-32 h-12 text-lg font-semibold",children:"Easy"})]}),(0,a.jsx)("p",{className:"mt-2 text-center text-xs text-slate-400",children:"Shortcuts: 1â€“4 or arrow keys"}),p&&(0,a.jsx)("p",{className:"mt-4 text-red-400",children:p})]},e.id)}):(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center text-center h-96",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold text-white",children:"All Done!"}),(0,a.jsx)("p",{className:"text-slate-300",children:"You've reviewed all available cards for now."})]})})]})})}},6554:(e,t,s)=>{Promise.resolve().then(s.bind(s,5927))}},e=>{e.O(0,[877,284,557,441,964,358],()=>e(e.s=6554)),_N_E=e.O()}]);